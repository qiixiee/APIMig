{"library_version": "8.5.2", "change_type": "Bug Fixes", "change_id": "LUCENE-9350", "change_description": ": Partial reversion of", "change_title": "Don't cache automata on FuzzyQuery", "detail_type": "Improvement", "detail_affect_versions": "None", "detail_fix_versions": "8.6,8.5.2", "detail_description": "LUCENE-9068 moved construction of FuzzyQuery's automaton directly onto the query itself.  However, as SOLR-14428 demonstrates, this ends up blowing up query caches that assume query objects are fairly small when calculating their memory usage.  We should move automaton construction back into FuzzyTermsEnum, while keeping as much of the nice refactoring of LUCENE-9068 as possible.", "patch_link": "none", "patch_content": "none"}
{"library_version": "8.5.2", "change_type": "Bug Fixes", "change_id": "LUCENE-9068", "change_description": ": Partial reversion of", "change_title": "Build FuzzyQuery automata up-front", "detail_type": "Improvement", "detail_affect_versions": "None", "detail_fix_versions": "8.5", "detail_description": "FuzzyQuery builds a set of levenshtein automata (one for each possible edit distance) at rewrite time, and passes them between different TermsEnum invocations using an attribute source.  This seems a bit needlessly complicated, and also means that things like visiting a query end up building the automata again.  We should instead build the automata at query construction time, which is how AutomatonQuery does it.", "patch_link": "none", "patch_content": "none"}
